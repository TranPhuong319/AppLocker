#!/bin/zsh --no-rcs

# ------------------------------------------------------
# AppLocker Postinstall Script
# ------------------------------------------------------

echo "üîß Ch·∫°y postinstall script..."

APP_HELPER="/Library/PrivilegedHelperTools/AppLockerHelper"
PLIST="/Library/LaunchDaemons/com.TranPhuong319.AppLockerHelper.plist"

# Check quy·ªÅn root
if [ "$EUID" -ne 0 ]; then
    echo "‚ùå Script c·∫ßn quy·ªÅn root. H√£y d√πng sudo."
    exit 1
fi

# 1Ô∏è‚É£ Set quy·ªÅn cho helper
if [ -f "$APP_HELPER" ]; then
    echo "üîß C·∫≠p nh·∫≠t quy·ªÅn helper..."
    chmod 755 "$APP_HELPER"
    chown root:wheel "$APP_HELPER"
else
    echo "‚ö†Ô∏è Helper tool kh√¥ng t·ªìn t·∫°i: $APP_HELPER"
fi

# 2Ô∏è‚É£ Set quy·ªÅn cho plist
if [ -f "$PLIST" ]; then
    echo "üîß C·∫≠p nh·∫≠t quy·ªÅn plist LaunchDaemon..."
    chmod 644 "$PLIST"
    chown root:wheel "$PLIST"

    # 3Ô∏è‚É£ Load LaunchDaemon
    echo "üöÄ Load LaunchDaemon..."
    launchctl bootstrap system "$PLIST"
else
    echo "‚ö†Ô∏è Plist LaunchDaemon kh√¥ng t·ªìn t·∫°i: $PLIST"
fi

echo "‚úÖ Postinstall ho√†n t·∫•t. AppLockerHelper ƒë√£ s·∫µn s√†ng."
exit 0
