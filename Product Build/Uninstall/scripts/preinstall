#!/bin/zsh --no-rcs

# ------------------------------------------------------
# AppLocker Preinstall Script
# ------------------------------------------------------

echo "üîß B·∫Øt ƒë·∫ßu ch·∫°y preinstall script..."

# Ki·ªÉm tra quy·ªÅn root
if [ "$EUID" -ne 0 ]; then
    echo "‚ùå Script c·∫ßn ch·∫°y v·ªõi quy·ªÅn root. H√£y d√πng sudo."
    exit 1
fi

# ƒê·∫∑t bi·∫øn cho d·ªÖ ch·ªânh s·ª≠a
APP_PATH="/Applications/AppLocker.app"
HELPER_PLIST="/Library/LaunchDaemons/com.TranPhuong319.AppLockerHelper.plist"
HELPER_TOOL="/Library/PrivilegedHelperTools/AppLockerHelper"

# 1Ô∏è‚É£ Xo√° app c≈© n·∫øu c√≤n t·ªìn t·∫°i
if [ -d "$APP_PATH" ]; then
    echo "‚ö†Ô∏è AppLocker c≈© ƒë√£ t·ªìn t·∫°i, xo√° tr∆∞·ªõc..."
    rm -rf "$APP_PATH"
fi

# 2Ô∏è‚É£ D·ª´ng helper daemon n·∫øu ƒëang ch·∫°y v√† xo√° file li√™n quan
if [ -f "$HELPER_PLIST" ]; then
    echo "‚ö†Ô∏è Helper daemon ƒëang ch·∫°y, d·ª´ng tr∆∞·ªõc..."
    launchctl bootout system "$HELPER_PLIST"

    echo "üóëÔ∏è Xo√° helper tool v√† plist..."
    rm -f "$HELPER_PLIST"
    rm -rf "$HELPER_TOOL"
fi
/usr/sbin/pkgutil --forget com.TranPhuong319.pkg.AppLocker
echo "‚úÖ Preinstall xong, m√¥i tr∆∞·ªùng ƒë√£ s·∫°ch v√† s·∫µn s√†ng c√†i m·ªõi."
exit 0
